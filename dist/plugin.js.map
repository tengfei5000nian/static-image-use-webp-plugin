{"version":3,"file":"plugin.js","names":["pluginName","StaticImageUseWebpPlugin","constructor","options","Object","assign","forceMinSize","isSupportWebpModule","includeExtensions","imageminWebpOptions","fileLoaderOptions","validate","defaultOptions","apply","compiler","isWebpackV5","webpack","version","loader","path","join","__dirname","test","RegExp","hooks","thisCompilation","tap","compilation","tapCallback","loaderContext","module","userRequest","defineProperty","get","loaders","unshift","NormalModule","getCompilationHooks","normalModuleLoader"],"sources":["../src/plugin.js"],"sourcesContent":["import path from 'path'\nimport { validate } from 'schema-utils'\nimport { NormalModule } from 'webpack'\n\nimport defaultOptions from './options.json'\n\nconst pluginName = 'static-image-use-webp-plugin'\n\nexport default class StaticImageUseWebpPlugin {\n  constructor(options = {}) {\n    this.options = Object.assign({\n      forceMinSize: false,\n      isSupportWebpModule: `${pluginName}/dist/support.js`,\n      includeExtensions: ['png', 'jpg', 'jpeg'],\n      imageminWebpOptions: {},\n      fileLoaderOptions: {}\n    }, options)\n\n    validate(defaultOptions, this.options)\n  }\n\n  apply(compiler) {\n    const isWebpackV5 = compiler.webpack && compiler.webpack.version >= '5'\n    const loader = path.join(__dirname, 'loader.js')\n    const test = new RegExp(`\\\\.(${this.options.includeExtensions.join('|')})($|\\\\\"|\\\\'|\\\\?)`)\n\n    compiler.hooks.thisCompilation.tap(pluginName, compilation => {\n\n      const tapCallback = (loaderContext, module) => {\n        if (!test.test(module.userRequest)) return\n\n        Object.defineProperty(loaderContext, 'currentModule', {\n          get: () => module\n        })\n\n        module.loaders.unshift({\n          loader,\n          options: this.options\n        })\n      }\n\n      if (isWebpackV5) {\n        NormalModule.getCompilationHooks(compilation).loader.tap(\n          pluginName,\n          tapCallback\n        )\n      } else {\n        compilation.hooks.normalModuleLoader.tap(pluginName, tapCallback)\n      }\n    })\n  }\n}\n"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;AAEA;;;;AAEA,MAAMA,UAAU,GAAG,8BAAnB;;AAEe,MAAMC,wBAAN,CAA+B;EAC5CC,WAAW,CAACC,OAAO,GAAG,EAAX,EAAe;IACxB,KAAKA,OAAL,GAAeC,MAAM,CAACC,MAAP,CAAc;MAC3BC,YAAY,EAAE,KADa;MAE3BC,mBAAmB,EAAG,GAAEP,UAAW,kBAFR;MAG3BQ,iBAAiB,EAAE,CAAC,KAAD,EAAQ,KAAR,EAAe,MAAf,CAHQ;MAI3BC,mBAAmB,EAAE,EAJM;MAK3BC,iBAAiB,EAAE;IALQ,CAAd,EAMZP,OANY,CAAf;IAQA,IAAAQ,qBAAA,EAASC,gBAAT,EAAyB,KAAKT,OAA9B;EACD;;EAEDU,KAAK,CAACC,QAAD,EAAW;IACd,MAAMC,WAAW,GAAGD,QAAQ,CAACE,OAAT,IAAoBF,QAAQ,CAACE,OAAT,CAAiBC,OAAjB,IAA4B,GAApE;;IACA,MAAMC,MAAM,GAAGC,aAAA,CAAKC,IAAL,CAAUC,SAAV,EAAqB,WAArB,CAAf;;IACA,MAAMC,IAAI,GAAG,IAAIC,MAAJ,CAAY,OAAM,KAAKpB,OAAL,CAAaK,iBAAb,CAA+BY,IAA/B,CAAoC,GAApC,CAAyC,kBAA3D,CAAb;IAEAN,QAAQ,CAACU,KAAT,CAAeC,eAAf,CAA+BC,GAA/B,CAAmC1B,UAAnC,EAA+C2B,WAAW,IAAI;MAE5D,MAAMC,WAAW,GAAG,CAACC,aAAD,EAAgBC,MAAhB,KAA2B;QAC7C,IAAI,CAACR,IAAI,CAACA,IAAL,CAAUQ,MAAM,CAACC,WAAjB,CAAL,EAAoC;QAEpC3B,MAAM,CAAC4B,cAAP,CAAsBH,aAAtB,EAAqC,eAArC,EAAsD;UACpDI,GAAG,EAAE,MAAMH;QADyC,CAAtD;QAIAA,MAAM,CAACI,OAAP,CAAeC,OAAf,CAAuB;UACrBjB,MADqB;UAErBf,OAAO,EAAE,KAAKA;QAFO,CAAvB;MAID,CAXD;;MAaA,IAAIY,WAAJ,EAAiB;QACfqB,qBAAA,CAAaC,mBAAb,CAAiCV,WAAjC,EAA8CT,MAA9C,CAAqDQ,GAArD,CACE1B,UADF,EAEE4B,WAFF;MAID,CALD,MAKO;QACLD,WAAW,CAACH,KAAZ,CAAkBc,kBAAlB,CAAqCZ,GAArC,CAAyC1B,UAAzC,EAAqD4B,WAArD;MACD;IACF,CAvBD;EAwBD;;AA1C2C"}